var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,c=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&i(e,a,t[a]);if(o)for(var a of o(t))n.call(t,a)&&i(e,a,t[a]);return e},r=(e,o)=>t(e,a(o));import{c as l,a as m,D as d,b as p,C as u,P as h,d as _,e as g,m as f,f as E,r as T,o as C,g as w,w as I,h as O,F as y,i as D,j as b,t as S,K as A,V as P,v,k as F,l as L,I as R}from"./vendor.92d3e6d8.js";const j="production";var x=c({env:j,mock:!1,namespace:"manager"},{baseApi:"/api",mockApi:"https://www.fastmock.site/mock/c1c302e8baed9894c48c17e4738c092e/api"});let H;const N={},$=function(e,t){if(!t)return e();if(void 0===H){const e=document.createElement("link").relList;H=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if(e in N)return;N[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":H,t||(o.as="script",o.crossOrigin=""),o.href=e,document.head.appendChild(o),t?new Promise(((e,t)=>{o.addEventListener("load",e),o.addEventListener("error",t)})):void 0}))).then((()=>e()))},k=()=>$((()=>import("./Category.3b1f055e.js")),["/assets/Category.3b1f055e.js","/assets/Category.206f6bd0.css","/assets/vendor.92d3e6d8.js"]),B=()=>$((()=>import("./TopicDetail.7cdf0852.js")),["/assets/TopicDetail.7cdf0852.js","/assets/TopicDetail.80e7877a.css","/assets/vendor.92d3e6d8.js","/assets/ReplyList.8b82d54c.js","/assets/ReplyList.8175edf4.css","/assets/index.e7d4a062.js"]),M=[{name:"home",path:"/",meta:{title:"首页"},component:()=>$((()=>import("./News.8a60945e.js")),["/assets/News.8a60945e.js","/assets/Forum.ddd22b7b.css","/assets/vendor.92d3e6d8.js","/assets/TopicItem.9609b67b.js","/assets/TopicItem.4ff92ad6.css","/assets/index.e7d4a062.js"])},{name:"login",path:"/login",meta:{title:"登录"},component:()=>$((()=>import("./Login.b1a18245.js")),["/assets/Login.b1a18245.js","/assets/Login.f6ffe23a.css","/assets/vendor.92d3e6d8.js"])},{path:"/topic",name:"topic",component:()=>$((()=>import("./Forum.0d53440f.js")),["/assets/Forum.0d53440f.js","/assets/Forum.ddd22b7b.css","/assets/vendor.92d3e6d8.js","/assets/TopicItem.9609b67b.js","/assets/TopicItem.4ff92ad6.css","/assets/index.e7d4a062.js"])},{path:"/topic/create",name:"createTopic",component:()=>$((()=>import("./CreateTopic.15caee2f.js")),["/assets/CreateTopic.15caee2f.js","/assets/CreateTopic.a3ec01a3.css","/assets/vendor.92d3e6d8.js"])},{path:"/topic/category",name:"topicCate",component:k,meta:{title:"论坛"}},{path:"/topic/:id",name:"topicDetail",component:B},{path:"/art/:id",name:"artDetail",component:()=>$((()=>import("./artDetail.cd70befa.js")),["/assets/artDetail.cd70befa.js","/assets/TopicDetail.80e7877a.css","/assets/vendor.92d3e6d8.js","/assets/ReplyList.8b82d54c.js","/assets/ReplyList.8175edf4.css","/assets/index.e7d4a062.js"])},{path:"/documents",name:"documents",component:()=>$((()=>import("./Documents.3ca5890b.js")),["/assets/Documents.3ca5890b.js","/assets/Documents.66f4d8fd.css","/assets/vendor.92d3e6d8.js"])},{path:"/documents/create",name:"createDocument",component:()=>$((()=>import("./CreateDocument.5244d65b.js")),["/assets/CreateDocument.5244d65b.js","/assets/CreateDocument.fd5c8ba5.css","/assets/vendor.92d3e6d8.js"]),meta:{requiresAuth:!0}},{path:"/documents/:id",name:"documentsDetail",component:B},{path:"/documents/category",name:"documentsCate",component:k,meta:{title:"文档"}}],V=l({history:m(),routes:M});var q={setItem(e,t){let a=this.getStroage();a[e]=t,window.localStorage.setItem(x.namespace,JSON.stringify(a))},getItem(e){return this.getStroage()[e]},getStroage:()=>JSON.parse(window.localStorage.getItem(x.namespace)||"{}"),clearItem(e){let t=this.getStroage();delete t[e],window.localStorage.setItem(x.namespace,JSON.stringify(t))},clearAll(){window.localStorage.clear()}};const J=["/users/upload"],U=[200,301,4003],z=d.create({baseURL:x.baseApi,timeout:2e4});function Y(e){e.method=e.method||"get","get"===e.method.toLowerCase()&&(e.params=e.data);let t=x.mock;return void 0!==e.mock&&(t=e.mock),"prod"===x.env?z.defaults.baseURL=x.baseApi:z.defaults.baseURL=t?x.mockApi:x.baseApi,z(e)}z.interceptors.request.use((e=>{if(e.data&&!J.includes(e.url)){let t=p.exports.AES.encrypt(JSON.stringify(e.data),u.get("secret")).toString();e.data={},e.data.secretData=t}return e})),z.interceptors.response.use((async e=>{const{code:t,msg:a}=e.data;return 301===t?(window.loginStatus=0,await h.confirm(a,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{console.log(V),V.push({name:"login",query:{redirect:location.pathname+location.search}})}))):U.includes(e.data.code)||_.error(a||"网络请求异常，请稍后重试"),e})),["get","post","put","delete","patch"].forEach((e=>{Y[e]=(t,a,o)=>Y(c({url:t,data:a,method:e},o))}));const K="FETCH_TOPIC_COMMENTS_ENTER_REPLAY";var W=g({modules:{appShell:{namespaced:!0,state:{baseInfo:{email:"",is_login:void 0}},mutations:{FETCH_BASE_INFO(e,t){e.baseInfo=Object.assign({},e.baseInfo,t),e.baseInfo.email.length>0?e.baseInfo.is_login=!0:e.baseInfo.is_login=!1}},actions:{async fetchBaseInfo({commit:e}){let t=await Y.post("/users/").then((e=>e.data)).catch((e=>e));return 200===t.code?e("FETCH_BASE_INFO",t.result):e("FETCH_BASE_INFO",{email:""}),Promise.resolve(t)}}},topic:{namespaced:!0,state:{homeData:{topic:{docs:[]},user:[]},cateList:[],topicData:null,topicDetailData:{},topicCommentsData:{}},mutations:{FETCH_HOME_DATA(e,t){console.log(t),Object.assign(e.homeData,t)},FETCH_TOPIC_DATA(e,t){e.topicData=t},FETCH_TOPIC_DETAIL(e,t){e.topicDetailData=t},FETCH_TOPIC_CATE(e,t){e.cateList=t},FETCH_TOPIC_COMMENTS(e,t){e.topicCommentsData=t},FETCH_TOPIC_COMMENTS_ENTER_REPLAY(e,t){e.topicCommentsData.docs.forEach((e=>{e.enterReply=!1,e.reply.forEach((e=>{e.enterReply=!1,e._id==t._id&&(e.enterReply=t.enterReply)})),e._id==t._id&&(e.enterReply=t.enterReply)}))}},actions:{async fetchTopicCate({commit:e},t){let a=await Y.post("/index/cats",t).then((e=>e.data));return 200===a.code&&e("FETCH_TOPIC_CATE",a.result),a},async fetchArticlesList({commit:e},t){let a=await Y.post("/index/articles",t).then((e=>e.data));return 200===a.code&&e("FETCH_TOPIC_DATA",a.result),a},createArticle:async({commit:e},t)=>await Y.post("/articles/create",t).then((e=>e.data)),async getTopicsDetail({commit:e},t){let a=await Y.post("/index/detail",t).then((e=>e.data));return 200===a.code&&e("FETCH_TOPIC_DETAIL",a.result),a},createComments:async({commit:e},t)=>await Y.post("/comments/create",t).then((e=>e.data)),async fetchComments({commit:e},t){let a=await Y.post("/index/comments",t).then((e=>e.data));return 200===a.code&&e("FETCH_TOPIC_COMMENTS",a.result),a},createCate:async({commit:e},t)=>await Y.post("/cats/create",t).then((e=>e.data)),deleteCate:async({commit:e},t)=>await Y.post("/cats/remove",t).then((e=>e.data)),async fetchHomeData({commit:e},t){let a=await Y.post("/index",t).then((e=>e.data));return 200===a.code&&e("FETCH_HOME_DATA",a.result),a}}},news:{namespaced:!0,state:{cateList:[],topicData:{}},mutations:{FETCH_TOPIC_CRALR(e,t){if(e.cateList.length||(e.cateList=t.nav),!t.docs.length)return e.topicData[`${t.slug}`].finish=!0,!1;e.topicData[`${t.slug}`]&&e.topicData[`${t.slug}`].docs?(e.topicData[`${t.slug}`].docs=[...e.topicData[`${t.slug}`].docs,...t.docs],delete t.docs,Object.assign(e.topicData[`${t.slug}`],t)):e.topicData[`${t.slug}`]=t}},actions:{async fetchTopicCate({commit:e},t={query:"channel",slug:"frontend"}){let a=await Y.get("/index/segmtn-list/articles",t).then((e=>e.data));return e("FETCH_TOPIC_CRALR",Object.assign(a.result,{slug:t.slug})),a}}}},strict:!1,plugins:[]});const G={register:e=>Y.post("/users/signIn/",e).then((e=>(200===e.data.code&&(window.loginStatus=1,W.commit("appShell/FETCH_BASE_INFO",e.data.result)),e.data))),login:e=>Y.post("/users/join/",e).then((e=>(200===e.data.code&&(window.loginStatus=1,W.commit("appShell/FETCH_BASE_INFO",e.data.result)),e.data))),logout:()=>Y.get("/users/logout/").then((e=>(200===e.data.code&&(window.loginStatus=0),e.data))),async loggedIn(){let e=!1;return void 0!==window.loginStatus?e=1==window.loginStatus:await Y.post("/users/").then((t=>{t&&200===t.data.code?(W.commit("appShell/FETCH_BASE_INFO",t.data.result),e=t.data.result.email.length>0):e=!1})),new Promise(((t,a)=>{t(e)}))},numberStr:e=>/^[0-9]*$/gi.test(e+="")};const Q={name:"app",computed:r(c({},f("appShell",["baseInfo"])),{activeName(){let e="home";return this.$route.path.includes("topic")&&(e="topic"),(this.$route.path.includes("documents")||this.$route.path.includes("/art/"))&&(e="documents"),(this.$route.path.includes("news")||G.numberStr(this.$route.path.replace(/^.+\//gi,"")))&&(e="news"),e}}),data:()=>({activeIndex:"home",links:[{text:"首页",routerName:"home"},{text:"论坛",routerName:"topic"},{text:"书籍",routerName:"documents"}]}),methods:r(c({},E("appShell",["fetchBaseInfo"])),{handleSelect(e){e&&e!=this.$route.name&&this.$router.push({name:e})},async logoutBtn(){await G.logout().then((e=>{200===e.code&&(this.$message.success(e.msg),setTimeout((()=>{this.$router.replace({name:"home"}),this.fetchBaseInfo()}),1e3))}))}}),created(){this.fetchBaseInfo()}},X={class:"container mx-auto px-5"},Z={class:"flex"},ee={class:"w-full flex justify-between items-center"},te={key:0,class:"flex user-info"},ae={class:"mr-4 user-email"},oe=b("退出"),se=b("登录");Q.render=function(e,t,a,o,s,n){const i=T("el-menu-item"),c=T("el-menu"),r=T("el-button"),l=T("el-header"),m=T("router-view"),d=T("el-main"),p=T("el-container");return C(),w(p,null,{default:I((()=>[O(l,{class:"shadow"},{default:I((()=>[O("div",X,[O("div",Z,[O("div",ee,[O(c,{"default-active":n.activeName,class:"el-menu-demo",mode:"horizontal",onSelect:n.handleSelect},{default:I((()=>[(C(!0),w(y,null,D(s.links,((e,t)=>(C(),w(i,{index:e.routerName,key:t},{default:I((()=>[b(S(e.text),1)])),_:2},1032,["index"])))),128))])),_:1},8,["default-active","onSelect"]),e.baseInfo.is_login?(C(),w("div",te,[O("div",ae,S(e.baseInfo.email),1),O(r,{onClick:n.logoutBtn},{default:I((()=>[oe])),_:1},8,["onClick"])])):(C(),w(r,{key:1,type:"primary",plain:"",onClick:t[1]||(t[1]=t=>e.$router.push({name:"login"}))},{default:I((()=>[se])),_:1}))])])])])),_:1}),O(d,{class:"bg-gray-50"},{default:I((()=>[(C(),w(A,null,[O(m,{class:"container mx-auto"})],1024))])),_:1})])),_:1})};P.use(v);const ne=F(Q);ne.use(P),ne.use(L),ne.config.globalProperties.$request=Y,ne.config.globalProperties.$storage=q,ne.use(V).use(W).use(R,{size:"middle"}).mount("#app");export{K as F,G as a};
