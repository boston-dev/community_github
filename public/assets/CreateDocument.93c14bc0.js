var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,i=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&o(e,a,t[a]);if(r)for(var a of r(t))s.call(t,a)&&o(e,a,t[a]);return e};import{m as c,f as d,r as n,n as u,p as m,o as p,g as h,h as g,w as f,F as b,i as y,t as F,j as w}from"./vendor.fd304484.js";const v={name:"createDocument",computed:i(i({},c("appShell",["baseInfo"])),c("topic",["cateList"])),data(){return this.resform=()=>({cat:"",title:"",cont:"",pic:"",type:3}),{valid:!0,loading:!1,artList:[],createForm:this.resform(),rules:{cat:[{required:!0,message:"请选择模块",trigger:"change"}],title:[{required:!0,message:"请输入文档标题",trigger:"blur"}],cont:[{required:!0,message:"请输入主题内容",trigger:"change"}]}}},async created(){await this.fetchTopicCate({query:{type:2}}),this.loading=!1},methods:(_=i({},d("topic",["fetchTopicCate","fetchArticlesList","createArticle"])),q={handleUploadImage(e,t,a){console.log(a);let r=new FormData;r.append("file",a[0]),this.$request.post("/users/upload",r).then((e=>{if(200==!e.data.code)return this.$message(e.data.msg),!1;t({url:e.data.result.src})}))},async edt(e){this.loading=!0;let t=await this.$request.post("/index/detail",{query:{_id:e._id}}).then((e=>e.data)).catch((e=>e));200===t.code&&(t.result.cat="string"==typeof t.result.cat?t.result.cat:t.result.cat._id,this.createForm=t.result),this.loading=!1},async change(e){if(!this.createForm.cat&&!e)return!1;this.loading=!0;let t=await this.$request.post("/index//bookArt",{query:{cat:this.createForm.cat||e},options:{sort:{date:-1}}}).then((e=>e.data)).catch((e=>e));200===t.code&&(this.artList=t.result),this.loading=!1},submitForm(e){this.$refs[e].validate((async e=>{if(e){this.loading=!0;let e=this.createForm.cat;await this.createArticle(this.createForm).then((e=>{200==e.code&&(this.$message.success(e.msg),this.createForm=this.resform())})),await this.change(e),this.loading=!1}}))}},t(_,a(q))),mounted(){console.log("mounted",this.$refs.myEditor)}};var _,q;const x={class:"document-wrapper",style:{"max-width":"inherit"}},O=g("div",{class:"card-header"},[g("span",null,"发布文档")],-1),V={class:"text-base font-bold"},j=w("发布");v.render=function(e,t,a,r,l,s){const o=n("el-col"),i=n("el-option"),c=n("el-select"),d=n("el-form-item"),w=n("el-input"),v=n("v-md-editor"),_=n("el-button"),q=n("el-form"),C=n("el-row"),U=n("el-card"),$=u("loading");return m((p(),h("div",x,[g(U,{class:"box-card"},{header:f((()=>[O])),default:f((()=>[g(C,{gutter:20},{default:f((()=>[g(o,{span:6},{default:f((()=>[(p(!0),h(b,null,y(l.artList,((e,t)=>(p(),h("div",{class:"item-wrap flex flex-col pa-4",key:e._id+t},[g("div",{class:"content",style:{padding:"4px 0"},onClick:t=>s.edt(e)},[g("strong",V,F(e.title),1)],8,["onClick"])])))),128))])),_:1}),g(o,{span:18},{default:f((()=>[g(q,{model:l.createForm,rules:l.rules,ref:"createForm","label-width":"100px",class:"demo-createForm"},{default:f((()=>[g(d,{label:"选择书名（分类）",prop:"cat"},{default:f((()=>[g(c,{onChange:s.change,modelValue:l.createForm.cat,"onUpdate:modelValue":t[1]||(t[1]=e=>l.createForm.cat=e),placeholder:"请选择模块"},{default:f((()=>[(p(!0),h(b,null,y(e.cateList,((e,t)=>(p(),h(i,{key:t,label:e.title,value:e._id},null,8,["label","value"])))),128))])),_:1},8,["onChange","modelValue"])])),_:1}),g(d,{label:"文档标题",prop:"title",rules:[{required:!0,message:"必填"}]},{default:f((()=>[g(w,{modelValue:l.createForm.title,"onUpdate:modelValue":t[2]||(t[2]=e=>l.createForm.title=e)},null,8,["modelValue"])])),_:1}),g(d,{prop:"cont",rules:[{required:!0,message:"必填"}]},{default:f((()=>[g(v,{"disabled-menus":[],class:"my-4",onUploadImage:s.handleUploadImage,modelValue:l.createForm.cont,"onUpdate:modelValue":t[3]||(t[3]=e=>l.createForm.cont=e),height:"400px"},null,8,["onUploadImage","modelValue"])])),_:1}),g(_,{type:"primary",onClick:t[4]||(t[4]=e=>s.submitForm("createForm"))},{default:f((()=>[j])),_:1})])),_:1},8,["model","rules"])])),_:1})])),_:1})])),_:1})],512)),[[$,l.loading]])};export default v;
